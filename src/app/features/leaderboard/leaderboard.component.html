<div class="leaderboard-container">
  <!-- Header -->
  <div class="leaderboard-header">
    <div class="header-content">
      <div class="header-title">
        <i class="fas fa-podium fs-2x text-warning"></i>
        <div class="header-text">
          <h1>{{ 'leaderboard.title' | translate }}</h1>
          <p class="header-subtitle">{{ 'leaderboard.subtitle' | translate }}</p>
        </div>
      </div>
    </div>
  </div>

  <!-- Loading State -->
  @if (isLoading()) {
  <div class="loading-container">
    <div class="spinner"></div>
    <p class="loading-text">{{ 'leaderboard.loading' | translate }}</p>
  </div>
  }

  <!-- Error State -->
  @if (errorMessage()) {
  <div class="error-container">
    <div class="alert alert-danger">
      <i class="fas fa-circle-info"></i>
      <div>
        <strong>{{ 'leaderboard.error' | translate }}</strong>
        <p>{{ errorMessage() }}</p>
      </div>
    </div>
  </div>
  }

  <!-- Leaderboard Content -->
  @if (!isLoading() && !errorMessage()) {
  <div class="leaderboard-content">
    <!-- My Rank Info Card -->
    @if (myRank()) {
    <div class="my-rank-card">
      <div class="rank-badge" [ngClass]="getRankColor(myRank()!)">
        @if (myRank() === 1) {
        <i class="fas fa-crown text-white"></i>
        } @else if (myRank() === 2) {
        <i class="fas fa-crown text-white"></i>
        } @else if (myRank() === 3) {
        <i class="fas fa-crown text-white"></i>
        } @else {
        <span class="rank-number">{{ myRank() }}</span>
        }
      </div>
      <div class="rank-info">
        <p class="rank-label">{{ 'leaderboard.yourPosition' | translate }}</p>
        <p class="rank-position">{{ 'leaderboard.position' | translate }}{{ myRank() }} {{ 'leaderboard.of' | translate
          }} {{ leaderboard().length }}</p>
      </div>
    </div>
    }

    <!-- Leaderboard Table Card -->
    <div class="leaderboard-card">
      <div class="table-responsive">
        <table class="leaderboard-table">
          <thead>
            <tr class="table-header">
              <th class="col-rank">
                <i class="fas fa-ranking fs-2"></i>
              </th>
              <th class="col-player">
                <i class="fas fa-user fs-2"></i>
                {{ 'leaderboard.player' | translate }}
              </th>
              <th class="col-age">{{ 'leaderboard.age' | translate }}</th>
              <th class="col-games">{{ 'leaderboard.games' | translate }}</th>
              <th class="col-high-score">
                <i class="fas fa-chart-pie fs-2"></i>
                {{ 'leaderboard.maxScore' | translate }}
              </th>
              <th class="col-total-score">{{ 'leaderboard.totalPoints' | translate }}</th>
              <th class="col-accuracy">{{ 'leaderboard.accuracy' | translate }}</th>
            </tr>
          </thead>
          <tbody>
            @for (player of leaderboard(); track player.player_id) {
            <tr class="table-row" [ngClass]="{ 'current-player': isCurrentPlayer(player.player_id) }">
              <!-- Rank Column -->
              <td class="col-rank">
                <div class="rank-cell" [ngClass]="getRankColor(player.rank)">
                  @if (player.rank === 1) {
                  <i class="fas fa-crown fs-2x text-warning"></i>
                  } @else if (player.rank === 2) {
                  <i class="fas fa-crown fs-2x text-gray-400"></i>
                  } @else if (player.rank === 3) {
                  <i class="fas fa-crown fs-2x" style="color: #cd7f32;"></i>
                  } @else {
                  <span class="rank-number">{{ player.rank }}</span>
                  }
                </div>
              </td>

              <!-- Player Name Column -->
              <td class="col-player">
                <div class="player-cell">
                  <i class="fas fa-user text-gray-500"></i>
                  <span class="player-name">{{ player.player_name }}</span>
                  @if (isCurrentPlayer(player.player_id)) {
                  <span class="you-badge">{{ 'leaderboard.you' | translate }}</span>
                  }
                </div>
              </td>

              <!-- Age Column -->
              <td class="col-age">
                <span class="age-value">{{ player.age }}</span>
              </td>

              <!-- Games Column -->
              <td class="col-games">
                <span class="games-value">{{ player.total_games }}</span>
              </td>

              <!-- High Score Column -->
              <td class="col-high-score">
                <span class="high-score-value">{{ player.high_score }}</span>
              </td>

              <!-- Total Score Column -->
              <td class="col-total-score">
                <span class="total-score-value">{{ player.total_score }}</span>
              </td>

              <!-- Accuracy Column -->
              <td class="col-accuracy">
                <div class="accuracy-cell">
                  <span class="accuracy-value"
                    [ngClass]="'accuracy-' + (player.overall_accuracy >= 75 ? 'high' : player.overall_accuracy >= 50 ? 'medium' : 'low')">
                    {{ formatAccuracy(player.overall_accuracy) }}%
                  </span>
                </div>
              </td>
            </tr>
            }
          </tbody>
        </table>
      </div>

      @if (leaderboard().length === 0) {
      <div class="no-data">
        <p>{{ 'leaderboard.noData' | translate }}</p>
      </div>
      }
    </div>

    <!-- Legend Section -->
    <div class="legend-section">
      <h3 class="legend-title">{{ 'leaderboard.information' | translate }}</h3>
      <div class="legend-items">
        <div class="legend-item">
          <i class="fas fa-crown text-warning"></i>
          <span class="legend-text">{{ 'leaderboard.goldFirst' | translate }}</span>
        </div>
        <div class="legend-item">
          <i class="fas fa-crown text-gray-400"></i>
          <span class="legend-text">{{ 'leaderboard.silverSecond' | translate }}</span>
        </div>
        <div class="legend-item">
          <i class="fas fa-crown" style="color: #cd7f32;"></i>
          <span class="legend-text">{{ 'leaderboard.bronzeThird' | translate }}</span>
        </div>
      </div>
    </div>

    <!-- Action Buttons -->
    <div class="action-buttons">
      <button class="btn btn-primary btn-lg" (click)="goToGame()">
        <i class="fas fa-gamepad"></i>
        {{ 'leaderboard.playNow' | translate }}
      </button>
      
      @if (myPlayerId()) {
      <button class="btn btn-info btn-lg text-white" (click)="goToProfile()">
        <i class="fas fa-user-circle"></i>
        {{ 'game.over.viewProfile' | translate }}
      </button>
      }

      <button class="btn btn-secondary btn-lg" (click)="goToPlay()">
        <i class="fas fa-home"></i>
        {{ 'leaderboard.backToMenu' | translate }}
      </button>
    </div>

    <!-- Footer Info -->
    <div class="leaderboard-footer">
      <p class="footer-text">
        <i class="fas fa-circle-info"></i>
        {{ 'leaderboard.updatedRealtime' | translate }} {{ leaderboard().length }} {{ 'leaderboard.playersInRanking' |
        translate }}
      </p>
    </div>
  </div>
  }
</div>